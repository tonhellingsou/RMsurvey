<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Onderzoek datavisualisatie 1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="lib/jspsych/jspsych.css">
  <script src="lib/jspsych/jspsych.js"></script>
  <script src="lib/jspsych/plugin-preload.js"></script>
  <script src="lib/jspsych/plugin-html-button-response.js"></script>
  <script src="lib/jspsych/plugin-survey-html-form.js"></script>
  <script src="lib/jspsych/plugin-html-keyboard-response.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body { background:#f3f3f3; margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .jspsych-content { max-width: 900px; margin:auto; }
    img.stim { max-width:80vw; max-height:65vh; display:block; margin:1rem auto; border:1px solid #ddd; }
    .muted { color:#666; font-size:0.95rem; }

    /* Card-style radios */
    /*.options { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:12px; margin:1rem auto 0; }*/
    .options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);  /* always two columns */
      gap: 12px;
      justify-items: stretch;
      margin-top: 1rem;
    }
    
    @media (max-width: 600px) {
      .options {
        grid-template-columns: 1fr;  /* stack vertically on small screens */
      }
    }
    .option-card {
      display:flex; align-items:center; gap:.6rem;
      background:#fff; border:1px solid #d8dbe0; border-radius:12px; padding:.8rem .9rem;
      cursor:pointer; transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
      /*height: 100%;*/
    }
    .option-card:hover { box-shadow:0 4px 10px rgba(0,0,0,.06); border-color:#cbd0d8; background:#f9fbff; }
    .option-card input[type="radio"] { transform:scale(1.2); accent-color:#2563eb; }

    /* Demographics layout */
    .form-grid { display:grid; gap:14px; grid-template-columns: 1fr 1fr; }
    .form-grid .full { grid-column:1 / -1; }
    .field-card {
      background:#fff; border:1px solid #d8dbe0; border-radius:12px; padding:12px 14px;
    }
    .field-card h4 { margin:.2rem 0 .6rem 0; font-size:1rem; }
    .chips { display:flex; flex-wrap:wrap; gap:10px; }
    .chip { padding:8px 12px; border-radius:999px; border:1px solid #d8dbe0; background:#fff; cursor:pointer; }
    .chip input { display:none; }
    .chip.selected { border-color:#2563eb; background:#eff6ff; }

    .btn-primary {
      display:inline-block; padding:.8rem 1.1rem; border-radius:10px; border:1px solid #2563eb;
      background:#2563eb; color:#fff; font-weight:600; cursor:pointer;
    }
    .center { text-align:center; }
    details summary { cursor:pointer; }
    .bi { vertical-align:-0.1em; }


    .field-card {
      background:#fff;
      border:1px solid #d8dbe0;
      border-radius:12px;
      padding:14px 16px;
      box-shadow:0 1px 2px rgba(0,0,0,.04);
    }
    .modern-select {
      width:100%;
      padding:.55rem .75rem;
      font-size:1rem;
      border:1px solid #cbd0d8;
      border-radius:8px;
      background:#fff;
      transition:border-color .2s, box-shadow .2s;
    }
    .modern-select:focus {
      outline:none;
      border-color:#2563eb;
      box-shadow:0 0 0 2px rgba(37,99,235,.2);
    }
  </style>
</head>
<body>
<script>
  
/* ---------------- CONFIG ---------------- */
const WEBHOOK = "https://script.google.com/macros/s/AKfycbxH_MD-ZK_fZ3Lug4WVMGb3I3VHBk5i--k_5zqAdfSdCrtovCQihElQBK4FsBN2B97x_w/exec";

// participant id
const PID = new URLSearchParams(location.search).get('pid') || (crypto.randomUUID?.() || Math.random().toString(36)).slice(0,8);

// Different answer choices per question
const ANSWER_CHOICES = {
  1: ["Op de pieken van 10u en 16u na, is de totale koffieverkoop redelijk constant gedurende de dag, maar het aandeel Americano daalt.","In de ochtend worden Cappuccino's het meest verkocht, in de avond zijn Chocolate drinks het populairst."],
  2: ["In februari 2025 vond een flinke stijging plaats in verkochte Americano's.","Het populairste drankje in oktober was de Chocolate drink."],
  3: ["De een na meest verkochte drank was Latte.","Chocolate drink zijn twee keer zo vaak verkocht als Cortado's."],
  4: ["Zes van de top tien warmste jaren vonden plaats in het decennium 2015-2024.","2019 was het eerste jaar waarin de gemiddelde temperatuur boven de 11 graden uitkwam."],
  5: ["In het huidige decennium is een toename van het aantal uren zonneschijn per dag waargenomen.","In de eerste helft van de vorige eeuw was er ongeveer net zo veel zonneschijn per dag als in 2000-2019."],
  6: ["Studenten zijn het meest eens met het statement dat de opleidingskwaliteit verhoogd is.","Studenten zijn het meer oneens dan eens met het statement dat ze informatie goed kunnen reproduceren."],
  7: ["Op het eerste gezicht lijken landen met hogere BBP per capita een hogere democratie-index te hebben.","De meeste landen zitten rond de $1K BBP en democratie-index 4."],
  8: ["De wereldbevolking blijft groeien en in recente jaren is Afrika relatief het snelst aan het groeien.","De wereldbevolking blijft groeien en in recente jaren is Europa hier een belangrijke drijfveer van."],
  9: ["In 2023 wordt meer dan de helft van de elektrische auto's in Azië verkocht.","In Europa werden in 2020 minder elektrische auto's verkocht dan in Azië."],
  10:["Al heeft Azië de grootste elektrische autoverkoop, Zuid-Amerika toonde in 2023 relatief de grootste groei.","Noord-Amerika groeide in 2023 qua verkoop van elektrische auto's relatief minder snel dan Europa."]
};


// Image banks (you currently have only q1_*; keep structure and add files later)
function bank(n){
  return [
    `img/q${n}_a.jpg`,`img/q${n}_b.jpg`,`img/q${n}_c.jpg`,`img/q${n}_d.jpg`,
    `img/q${n}_e.jpg`,`img/q${n}_f.jpg`,`img/q${n}_g.jpg`,`img/q${n}_h.jpg`
  ];
}
const questionBanks = Array.from({length:10}, (_,i)=>bank(i+1));

/* ---------------- HELPERS ---------------- */
const pick = arr => arr[Math.floor(Math.random()*arr.length)];
function shuffle(a){ const c=a.slice(); for(let i=c.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [c[i],c[j]]=[c[j],c[i]];} return c; }

// POST with CORS then no-cors fallback
async function postRows(rows){
  try {
    const res = await fetch(WEBHOOK,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(rows)});
    if(res.ok) return {ok:true,mode:'cors'};
  } catch(_){}
  try {
    await fetch(WEBHOOK,{method:'POST',mode:'no-cors',body:JSON.stringify(rows)});
    return {ok:true,mode:'no-cors'};
  } catch(e){ return {ok:false,error:String(e)}; }
}

/* ---------------- JSPSYCH ---------------- */
const jsPsych = initJsPsych({
  on_finish: async () => {
    document.body.innerHTML = `
      <div style="text-align:center;padding:3rem">
        <h2>Je antwoorden worden opgeslagen. Sluit dit venster nog niet.</h2>
      </div>`;
  
    // Pull both pretest and main survey trials
    const trials = jsPsych.data.get().filterCustom(t => t.kind === 'pretest' || t.kind === 'question').values();
  
    // Normalize rows and guarantee participant_id is present
    const rows = trials.map((t, i) => ({
      participant_id: PID,
      trial: t.kind === 'pretest' ? t.question_id : (i + 1),   // e.g., K1..K5 for pretest, 1..N for survey
      question_id: t.question_id || '',
      image: t.image || '',
      response: (t.response ?? '').toString(),
      rt: Number.isFinite(t.rt) ? Math.round(t.rt) : ''
    }));
  
    // Demographics (if present)
    const demo = jsPsych.data.get().filter({ kind: 'demographics' }).values()[0];
    if (demo) {
      rows.push({
        participant_id: PID,
        trial: 'demographics',
        question_id: 'demographics',
        image: '',
        response: JSON.stringify(demo.response || {}),
        rt: ''
      });
    }

    // optional name & comments
    const fb = jsPsych.data.get().filter({ kind: 'feedback' }).values()[0];
    if (fb) {
      rows.push({
        participant_id: PID,
        trial: 'feedback',
        question_id: 'feedback',
        image: '',
        response: JSON.stringify(fb.response || {}),
        rt: ''
      });
    }
  
    const result = await postRows(rows);
    document.body.innerHTML = result.ok
      ? `<div style="padding:2rem;text-align:center"><h2>✅ Dankjewel!</h2><p>Je antwoorden zijn opgeslagen.</p></div>`
      : `<div style="padding:2rem;text-align:center"><h2>⚠️ Upload niet gelukt.</h2><p>${result.error||''}</p></div>`;
  }
});

const timeline = [];

/* ---------------- INTRO ---------------- */
timeline.push({
  type: jsPsychHtmlKeyboardResponse,
  choices: "NO_KEYS",
  stimulus: `
    <div style="text-align:left;max-width:720px;margin:1cm auto;padding:0 1cm;">
      <h1 style="margin:0 0 .5rem 0; line-height:1.2;">
        Onderzoek naar interpretatiesnelheid van datavisualisaties
      </h1>

      <p>
        Welkom! Dankjewel dat je wilt meehelpen aan ons onderzoek rondom 
        interpretatie van datavisualisaties. 
        Voorafgaand aan het onderzoek maak je eerst een korte 
        <b>pretest van 5 vragen</b> over basiskennis van data.
      </p>

      <p>
        Dit helpt ons een beeld te krijgen van je voorkennis over data en 
        visualisaties. Daarna volgt het echte onderzoek. Het totaal duurt 
        hopelijk slechts vijf minuten.
      </p>

      <ul style="list-style:none;padding:0;margin:1rem 0;">
        <li style="margin:.6em 0; text-indent:-1.2em; padding-left:1.8em;">
          <i class="bi bi-stopwatch" style="color:#2563eb;margin-right:.5em;"></i>
          <b>5 testvragen</b> om te starten, gevolgd door de survey met <b>10 afbeeldingen</b>.
        </li>
        <li style="margin:.6em 0; text-indent:-1.2em; padding-left:1.8em;">
          <i class="bi bi-lightning-charge" style="color:#eab308;margin-right:.5em;"></i>
          Je <b>reactietijd</b> wordt gemeten voor elk antwoord.
        </li>
        <li style="margin:.6em 0; text-indent:-1.2em; padding-left:1.8em;">
          <i class="bi bi-hourglass-split" style="color:#f97316;margin-right:.5em;"></i>
          Het onderzoek is <b>tijdsgebonden</b> en kan niet worden gepauzeerd zodra het is gestart.
        </li>
        <li style="margin:.6em 0; text-indent:-1.2em; padding-left:1.8em;">
          <i class="bi bi-shield-lock" style="color:#16a34a;margin-right:.5em;"></i>
          Je resultaten zijn <b>vertrouwelijk</b> en worden alleen voor onderzoek gebruikt.
        </li>
      </ul>

      <div class="center" style="margin-top:1rem">
        <button id="begin" class="btn-primary">Beginnen</button>
      </div>
      <p class="muted center" style="margin-top:.6rem">
        Deelnemer: <b>${PID}</b>
      </p>
    </div>
  `,
  on_load: () => {
    document.getElementById('begin').addEventListener('click', () => jsPsych.finishTrial());
  }
});

/* ---------------- PRELOAD (optioneel, doorgaan na fouten) ---------------- */
timeline.push({
  type: jsPsychPreload,
  images: questionBanks.flat(),
  show_progress_bar:true,
  message:'Afbeeldingen worden geladen…',
  continue_after_error:true
});

/* ---------------- READY SCREEN: Pretest ---------------- */
timeline.push({
  type: jsPsychHtmlKeyboardResponse,
  choices: "NO_KEYS",
  stimulus: `
    <div style="text-align:center;max-width:600px;margin:auto;">
      <h2>De pre-test begint</h2>
      <p>Deze korte pre-test controleert je basiskennis van data en visualisaties.</p>>
      <p>De vragen hebben een wisselende moeilijkheidsgraad en het is geen probleem indien ze niet allemaal juist beantwoord worden.</p>
      <p>Klik op de knop hieronder wanneer je klaar bent om te starten.</p>
      <button id="start-pretest" class="btn-primary" style="margin-top:1rem;">Start pretest</button>
    </div>
  `,
  on_load: () => {
    document.getElementById('start-pretest').addEventListener('click', () => jsPsych.finishTrial());
  }
});
  
/* ---------------- PRETEST: 5 Data Knowledge Questions ---------------- */
const PRETEST = [
  {
    id: "K1",
    q: "Een staafdiagram vergelijkt het aantal leerlingen in verschillende klassen. Wat vertegenwoordigt de hoogte van elke staaf?",
    choices: [
      "Het aantal leerlingen ✅",
      "De naam van de klas",
      "De kleur die voor die klas wordt gebruikt",
      "Het gemiddelde cijfer"
    ],
    correct: "Het aantal leerlingen ✅"
  },
  {
    id: "K2",
    q: "We hebben een staafdiagram dat de gemiddelde maandelijkse neerslag toont. Wat staat er meestal op de x-as?",
    choices: [
      "De hoeveelheid neerslag",
      "De maanden van het jaar ✅",
      "Het weertype",
      "De gemiddelde temperatuur"
    ],
    correct: "De maanden van het jaar ✅"
  },
  {
    id: "K3",
    q: "Bij het vergelijken van twee boxplots laat de boxplot met een langere box het volgende zien:",
    choices: [
      "Hogere gemiddelde waarden",
      "Grotere variabiliteit ✅",
      "Minder datapunten",
      "Geen uitschieters"
    ],
    correct: "Grotere variabiliteit ✅"
  },
  {
    id: "K4",
    q: "Een scatterplot laat zien dat naarmate de temperatuur stijgt, de ijsverkoop ook toeneemt. Wat voor soort relatie suggereert dit?",
    choices: [
      "Negatieve correlatie",
      "Positieve correlatie ✅",
      "Geen correlatie",
      "Willekeurige variatie"
    ],
    correct: "Positieve correlatie ✅"
  },
  {
    id: "K5",
    q: "In een staafdiagram (met positieve waarden tussen de 80 en 130) begint de y-as bij 40 in plaats van bij 0. Welk effect heeft dit sowieso?",
    choices: [
      "Het laat verschillen groter lijken dan ze zijn ✅",
      "Het laat verschillen kleiner lijken dan ze zijn",
      "Het heeft geen effect",
      "Het verbetert de leesbaarheid"
    ],
    correct: "Het laat verschillen groter lijken dan ze zijn ✅"
  }
];


/* ---------------- PRETEST: 5 Data Knowledge Questions (fixed timing & PID) ---------------- */
PRETEST.forEach((item, idx) => {
  const shuffled = jsPsych.randomization.shuffle(item.choices);

  timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    choices: "NO_KEYS",
    stimulus: `
      <div style="text-align:left;max-width:700px;margin:auto;">
        <h3>Pre-testvraag ${idx + 1} / ${PRETEST.length}</h3>
        <p style="margin:1em 0;font-size:1.05rem;">${item.q}</p>
        <div class="options">
          ${shuffled.map(opt => `
            <label class="option-card">
              <input type="radio" name="answer" value="${opt}">
              <span>${opt.replace(" ✅","")}</span>
            </label>`).join("")}
        </div>
      </div>
    `,
    on_load: () => {
      const root = jsPsych.getDisplayElement();
      const radios = root.querySelectorAll('input[type=radio][name=answer]');

      // Start timer after paint
      let t0 = 0;
      requestAnimationFrame(() => { t0 = performance.now(); });

      radios.forEach(r => {
        r.addEventListener('change', () => {
          const rt = Math.round(performance.now() - t0);
          jsPsych.finishTrial({
            kind: 'pretest',
            participant_id: PID,
            question_id: item.id,
            question_text: item.q,
            response: r.value.replace(" ✅",""),
            correct_answer: item.correct.replace(" ✅",""),
            correct: r.value.includes("✅"),
            rt: rt
          });
        }, { once:true });
      });
    }
  });
});

/* ---------------- READY SCREEN: Main Survey ---------------- */
timeline.push({
  type: jsPsychHtmlKeyboardResponse,
  choices: "NO_KEYS",
  stimulus: `
    <div style="text-align:center;max-width:600px;margin:auto;">
      <h2>Het hoofdonderzoek begint</h2>
      <p>Hierin beantwoord je vragen over <b>10 datavisualisaties</b>.</p>
      <p>Elke visualisatie verschijnt op het scherm, en je kiest zo snel en nauwkeurig mogelijk het beste antwoord.</p>
      <p>Er zitten goede en slechte visualisaties tussen, dus soms wordt het moeilijk gemaakt het juiste antwoord te vinden. Dat is intentioneel en er wordt geen beoordeling van je data-interpretatievaardigheden gemaakt.</p>
      <p>Klik hieronder wanneer je klaar bent om met het onderzoek te beginnen.</p>
      <p>Herinnering: Je kunt het onderzoek niet pauzeren.</p>
      <button id="start-survey" class="btn-primary" style="margin-top:1rem;">Start onderzoek</button>
    </div>
  `,
  on_load: () => {
    document.getElementById('start-survey').addEventListener('click', () => jsPsych.finishTrial());
  }
});
  
/* ---------------- QUESTIONS (radio + randomized order + true one-click advance) ---------------- */
questionBanks.forEach((bank, i) => {
  const qnum = i + 1;
  const chosen = pick(bank);
  const baseChoices = ANSWER_CHOICES[qnum] || ["Option 1","Option 2"];
  const shuffled = shuffle(baseChoices);

  timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    choices: "NO_KEYS", // we’ll finish the trial ourselves when a radio is clicked
    stimulus: `
      <div style="text-align:center">
        <h3>Vraag ${qnum} / 10</h3>
        <img class="stim" src="${chosen}" alt="stimulus ${qnum}">
        <p class="muted">Welke bewering is juist?</p>
      </div>
      <div class="options" id="optwrap">
        ${shuffled.map(ch => `
          <label class="option-card">
            <input type="radio" name="answer" value="${ch}">
            <span>${ch}</span>
          </label>`).join("")}
      </div>
    `,
    on_load: () => {
      const root = jsPsych.getDisplayElement();
      const img  = root.querySelector('img.stim');
      const radios = root.querySelectorAll('input[type=radio][name=answer]');
    
      // Disable radios until the image is fully decoded and painted.
      radios.forEach(r => r.disabled = true);
    
      let t0 = 0;
      const start = () => {
        // mark the real start time only now (image visible)
        t0 = performance.now();
        radios.forEach(r => r.disabled = false);
      };
    
      // Start timing after the browser confirms pixels are ready
      if (img && typeof img.decode === 'function') {
        img.decode().catch(()=>{}).finally(start);
      } else {
        // Fallback if decode() isn’t supported
        if (img && !img.complete) img.addEventListener('load', start, { once:true });
        else start();
      }
    
      // One-click advance with correct RT
      radios.forEach(r => {
        r.addEventListener('change', () => {
          const rt = Math.round(performance.now() - t0);
          jsPsych.finishTrial({
            kind: 'question',
            participant_id: PID,
            question_id: `Q${qnum}`,
            image: chosen,
            response: r.value,
            rt: rt,
            choice_order: shuffled.join(' | ')
          });
        }, { once:true });
      });
    }
  });
});

/* ---------------- DEMOGRAPHICS (modern dropdowns) ---------------- */
timeline.push({
  type: jsPsychHtmlKeyboardResponse,
  choices: "NO_KEYS",
  stimulus: `
    <div style="max-width:600px;margin:0 auto;">
      <h3 class="center">Bijna klaar - nog een paar achtergrondvragen</h3>

  <div class="field-card" style="margin-top:1rem;">
    <label style="display:block;margin-bottom:.3rem;font-weight:600;">Leeftijdsgroep</label>
    <select name="age" id="age" class="modern-select">
      <option value="">Selecteer…</option>
      <option>18–24</option>
      <option>25–34</option>
      <option>35–44</option>
      <option>45–54</option>
      <option>55–64</option>
      <option>65+</option>
    </select>
  </div>
  
  <div class="field-card" style="margin-top:1rem;">
    <label style="display:block;margin-bottom:.3rem;font-weight:600;">Hoogst voltooide opleiding</label>
    <select name="education" id="education" class="modern-select">
      <option value="">Selecteer…</option>
      <option>Middelbare school</option>
      <option>Bachelor</option>
      <option>Master</option>
      <option>Promotie / PhD</option>
      <option>Anders</option>
    </select>
  </div>
  
  <div class="field-card" style="margin-top:1rem;">
    <label style="display:block;margin-bottom:.3rem;font-weight:600;">Geslacht</label>
    <select name="gender" id="gender" class="modern-select">
      <option value="">Selecteer…</option>
      <option>Man</option>
      <option>Vrouw</option>
      <option>Anders</option>
      <option>Zeg ik liever niet</option>
    </select>
  </div>
  
  <div class="field-card" style="margin-top:1rem;">
    <label style="display:block;margin-bottom:.3rem;font-weight:600;">Hoe zou je je eigen datageletterdheid inschatten? (1–5)</label>
    <input 
      type="range" id="literacy" min="1" max="5" step="1" value="3"
      oninput="document.getElementById('litval').textContent=this.value"
      style="width:100%;">
    <div class="center muted">Waarde: <span id="litval">3</span></div>
  </div>
  
  <div class="field-card" style="margin-top:1rem;">
    <label style="display:block;margin-bottom:.3rem;font-weight:600;">Werksector</label>
    <select name="industry" id="industry" class="modern-select">
      <option value="">Selecteer…</option>
      <option>Administratieve beroepen</option>
      <option>Agrarisch en groen</option>
      <option>Autobranche</option>
      <option>Bouw</option>
      <option>Cultuur, sport en recreatie</option>
      <option>Detail- en groothandel</option>
      <option>Financiële dienstverlening</option>
      <option>Horeca</option>
      <option>ICT-beroepen</option>
      <option>Industrie</option>
      <option>Klimaat</option>
      <option>Onderwijs</option>
      <option>Overheid</option>
      <option>Sociaal werk, jeugdzorg en kinderopvang</option>
      <option>Transport en logistiek</option>
      <option>Zakelijke dienstverlening</option>
      <option>Zorg</option>
    </select>
  </div>
  
  <div class="center" style="margin-top:1.5rem;">
    <button id="submit-demo" class="btn-primary">Verzenden</button>
  </div>

  `,
  on_load: () => {
    document.getElementById('submit-demo').addEventListener('click', () => {
      const getVal = id => document.getElementById(id).value.trim();
      const payload = {
        age: getVal('age'),
        education: getVal('education'),
        gender: getVal('gender'),
        literacy: getVal('literacy'),
        industry: getVal('industry')
      };
      // simple validation
      const missing = ['age','education','gender','industry'].filter(k => !payload[k]);
      if (missing.length) {
        alert("Please fill in: " + missing.join(", "));
        return;
      }
      jsPsych.finishTrial({ kind:'demographics', response: payload });
    });
  }
});

/* ---------------- OPTIONAL NAME & COMMENTS ---------------- */
timeline.push({
  type: jsPsychHtmlKeyboardResponse,
  choices: "NO_KEYS",
  stimulus: `
    <div style="max-width:650px;margin:0 auto;">
      <h3 class="center">Tot slot (optioneel)</h3>
      <p>Als je wilt, kun je hieronder je naam invullen en eventuele opmerkingen of feedback achterlaten.</p>

      <div class="field-card" style="margin-top:1rem;">
        <label style="display:block;margin-bottom:.3rem;font-weight:600;">
          Naam (optioneel)
        </label>
        <input type="text" id="fb-name" class="modern-select"
               placeholder="Je naam of initialen">
      </div>

      <div class="field-card" style="margin-top:1rem;">
        <label style="display:block;margin-bottom:.3rem;font-weight:600;">
          Opmerkingen of feedback (optioneel, max. 500 tekens)
        </label>
        <textarea id="fb-comments" rows="4" maxlength="500"
          style="width:100%;padding:.55rem .75rem;font-size:1rem;
                 border:1px solid #cbd0d8;border-radius:8px;"></textarea>
        <div class="muted" style="text-align:right;margin-top:.25rem;">
          <span id="fb-count">0</span> / 500
        </div>
      </div>

      <div class="center" style="margin-top:1.5rem;">
        <button id="fb-submit" class="btn-primary">Verzenden en afsluiten</button>
      </div>
    </div>
  `,
  on_load: () => {
    const ta = document.getElementById('fb-comments');
    const counter = document.getElementById('fb-count');
    ta.addEventListener('input', () => {
      counter.textContent = ta.value.length.toString();
    });

    document.getElementById('fb-submit').addEventListener('click', () => {
      const payload = {
        name: document.getElementById('fb-name').value.trim(),
        comments: ta.value.trim()
      };
      jsPsych.finishTrial({ kind: 'feedback', response: payload });
    });
  }
});



/* ---------------- RUN ---------------- */
jsPsych.run(timeline);
</script>
</body>
</html>
